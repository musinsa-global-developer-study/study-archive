# 2022년 11월 29일

## SubModule Study

### `Root Repository` 에서 `SubModule` 에 대한 커밋 히스토리를 관리해야할까?

서브모듈의 `Remote` 가 변경되었을 때 `Root Repository` 에서 서브모듈을 최신 이력으로 업데이트했을 때 `Root Repository` 의 Stage를 확인하면 `modified {서브모듈} (new commits)` 내용으로 변경이 되었음을 알려줍니다.

``` 
$ git status

...

Changes not staged for commit:
    modified:   {서브모듈} (new commits)

...
```

`Root Repository` 에서는 서브모듈을 `read only` 성격으로 사용하는데 서브모듈의 변경사항에 대해서도 커밋을 해서 관리를 해주어야할까 의문이 들었습니다. 그냥 ignore 처리를 하는 것이 더 낫지 않을까 생각이 들어 체크를 해보았습니다.

### `Root Repositoy` 에 `SubModule` 을 추가해보자

Root Repository에 서브모듈을 추가하기 위해 먼저 사전세팅을 진행했습니다.

- `Root Repository` 로 사용할 Public Repository를 생성합니다.
- `SubModule` 로 사용할 Private Repository를 생성합니다.

레포지토리 생성이 완료되면 루트 레포지토리에 서브모듈을 구성합니다.

- `Root Repository` 에 `SubModule` 을 구성합니다. 샘플이여서 {Root Repository Root}/submodule 경로로 생성해보았습니다.
  ``` bash
  # git submodule add [자신의 private 저장소] [SubModoule Directory Path]]
  $ git submodule add https://github.com/musinsa-global-developer-study/study-submodule.git submodule
  ```

루트 레포지토리에 README.md 파일만 있고 서브모듈 레포지토리도 README.md 만 있는 경우에서 서브모듈을 추가하면 아래와 같이 파일이 구성됩니다.
``` bash
.
├── .git
├── .gitmodules
├── README.md
└── submodule
    ├── .git
    └── README.md
```

이 상황에서 `SubModule` 의 `Remote` 가 변경이 발생되었을 때 루트 레포지토리에서 서브모듈을 업데이트 후 루트 레포지토리의 상태를 확인하면 아래와 같습니다.

- (SubModule 의 Remote 변경이 발생)
- `Root Repository` 에서 `SubModule` 을 최신화합니다.
  ``` bash
  # 서브 모듈을 Remote 로 부터 Pull을 한다.
  $ git submodule foreach git fetch origin main
  $ git submodule foreach git rebase origin/main
  ```
- `Root Repository` 의 git stage 상태 확인합니다.

  ```
  $ git status

  ...

  Changes not staged for commit:
      modified:   submodule (new commits)

  ...
  ```

